<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Crypto Trader</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.16/dist/sweetalert2.min.css" />
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.16/dist/sweetalert2.all.min.js"></script>
    </head>

    <body>
        <div class="button-container">
            <button class="button button-blue" onclick="sendChatIdToBackend(chatId)">Check ID</button>
        </div>
        <script>
            Telegram.init({
                // Specify your bot username or deep linking parameters
                // based on your application's requirements
                bot_username: "zelyxa_bot",
                // ... Other options
            });

            // Listen for the 'tgWebAuth' event to retrieve the user's chat ID
            window.addEventListener("tgWebAuth", function (e) {
                const chatId = e.detail.user_id;
                console.log("Chat ID:", chatId);

                // Send the chat ID to the backend server
                sendChatIdToBackend(chatId);
            });

            function sendChatIdToBackend(chatId) {
                const serverUrl = "https://2533-82-24-140-107.ngrok-free.app/id";
                const payload = {
                    chatId: chatId,
                };

                fetch(serverUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log("Server Response:", data);
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                    });
            }
        </script>
    </body>
</html>
